<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Drumpad mit Loop-Schalter</title>
<style>
  body {
    font-family: sans-serif;
    background: #111;
    color: white;
    text-align: center;
  }
  .pad-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin: 20px;
  }
  .pad {
    background: #444;
    border: none;
    border-radius: 10px;
    height: 120px;
    color: white;
    font-size: 14px;
    position: relative;
    padding: 5px;
  }
  .pad.active {
    background: gold;
  }
  .menu {
    position: absolute;
    top: 5px;
    right: 10px;
    font-size: 20px;
    cursor: pointer;
  }
  .loop-switch {
    position: absolute;
    bottom: 5px;
    left: 10px;
    font-size: 12px;
    cursor: pointer;
    color: #0f0;
  }
  button#stopBtn {
    margin-top: 20px;
    background: red;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 20px;
    font-size: 18px;
  }
</style>
</head>
<body>
<h1>ðŸŽ§ Mini Drumpad</h1>
<div class="pad-grid" id="padGrid"></div>
<button id="stopBtn">STOP</button>

<script>
const pads = [];
const padGrid = document.getElementById("padGrid");
const stopBtn = document.getElementById("stopBtn");

// 8 Pads erstellen
for (let i = 0; i < 8; i++) {
  const pad = document.createElement("button");
  pad.className = "pad";
  pad.innerHTML = `Pad ${i+1} <span class="menu">â‹®</span><br><span class="loop-switch">Loop: Off</span>`;
  padGrid.appendChild(pad);

  pads.push({ element: pad, sound: null, loop: false, audio: null });

  // Klick -> Sound abspielen
  pad.addEventListener("click", () => playSound(i));

  // Dreipunkt-MenÃ¼ -> Datei wÃ¤hlen
  pad.querySelector(".menu").addEventListener("click", (event) => {
    event.stopPropagation();
    selectFile(i);
  });

  // Loop-Schalter
  pad.querySelector(".loop-switch").addEventListener("click", (event) => {
    event.stopPropagation();
    toggleLoop(i);
  });
}

// Datei auswÃ¤hlen
function selectFile(i) {
  const input = document.createElement("input");
  input.type = "file";
  input.accept = "audio/*";
  input.onchange = e => {
    const file = e.target.files[0];
    if (file) {
      const url = URL.createObjectURL(file);
      pads[i].sound = url;
      updatePadText(i);
    }
  };
  input.click();
}

// Loop-Schalter umschalten
function toggleLoop(i) {
  pads[i].loop = !pads[i].loop;
  updatePadText(i);
}

// Text und Loop-Anzeige aktualisieren
function updatePadText(i) {
  const pad = pads[i];
  const filename = pad.sound ? pad.sound.split("/").pop() : "";
  const loopText = pad.loop ? "On" : "Off";
  pad.element.innerHTML = `Pad ${i+1}<br>${filename}<span class="menu">â‹®</span><br><span class="loop-switch">Loop: ${loopText}</span>`;

  // EventListener neu setzen (wegen innerHTML)
  pad.element.querySelector(".menu").addEventListener("click", (ev) => { ev.stopPropagation(); selectFile(i); });
  pad.element.querySelector(".loop-switch").addEventListener("click", (ev) => { ev.stopPropagation(); toggleLoop(i); });
}

// Sound abspielen
function playSound(i) {
  const pad = pads[i];
  if (!pad.sound) return;

  if (pad.loop) {
    // Loop-Play
    if (pad.audio && !pad.audio.paused) {
      // Wenn schon lÃ¤uft, stoppen
      pad.audio.pause();
      pad.audio.currentTime = 0;
      pad.element.classList.remove("active");
      return;
    }
    const audio = new Audio(pad.sound);
    audio.loop = true;
    audio.play();
    pad.audio = audio;
    pad.element.classList.add("active");
  } else {
    // Einmal abspielen
    const audio = new Audio(pad.sound);
    audio.play();
    pad.audio = audio;
    pad.element.classList.add("active");
    audio.onended = () => pad.element.classList.remove("active");
  }
}

// STOP-Button: alles stoppen
stopBtn.addEventListener("click", () => {
  pads.forEach(pad => {
    if (pad.audio) {
      pad.audio.pause();
      pad.audio.currentTime = 0;
      pad.element.classList.remove("active");
    }
  });
});
</script>
</body>
</html>
